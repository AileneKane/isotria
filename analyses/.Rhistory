setwd("~/git/isotria/analyses")
setwd("~/git/isotria/analyses")
isoinds<-read.csv("Isotria_Stage4_2016.csv", header=T)#
head(isoinds)
isoinds<-isoinds[isoinds$Year<2016,]#remove data from 2016 as it was incomplete i think.
dim(isoinds)#32559    18
inds<-unique(isodat$UniqueID)#2473 plants
#get fates of each plant
#get fates of each plant
present = isoinds[isoinds$Year < 2015& isoinds$Year >1983, ]; present = present[order(present$UniqueID),]; present = present[order(present$Year),]
dim(present)# 31837 rows, 18 columns
future = isoinds[isoinds$Year > 1984, ]; future = future[order(future$UniqueID),]; future = future[order(future$Year),]
dim(future)#31752 rows, 18 columns
head(present);head(future)
colnames(future)
future$YearFate=future$Year-1
#Merge present and future to get fates
isofate<-merge(present,future,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearFate","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past/future, as well
isofate2<-merge(present,future,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearFate","Group",  "Block", "Plant","YearFound"))#this only includes plants for which there is fate data that matches
dim(isofate);dim(isofate2)
head(isofate2)
colnames(isofate)
isofate=isofate[,-19]#remove year column
isofate2=isofate2[,-19]
#add column names
colnames(isofate)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Stage","Stage2","Stage3","Emerg","Stage4","FutNoVegStems","FutNoArrStems","FutNoFlStems","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","FutEmerg","Fate4")
colnames(isofate2)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Stage","Stage2","Stage3","Emerg","Stage4","FutNoVegStems","FutNoArrStems","FutNoFlStems","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","FutEmerg","Fate4")
head(isofate); head(isofate2)
#I think I will mostly use isofate2, which only includes matches, so stick with that one for rest of formatting
###Now add stage before dormancy to isofate2 dataset.
past = isoinds[isoinds$Year < 2015,]; past = past[order(past$UniqueID),]; past = past[order(past$Year),]
dim(past)# 30942 (present=30644 rows)
dim(present)# 30942 (present=30644 rows)
dim(past)# 32135 (present=31837 rows)
past$YearPrev=past$Year+1
#Merge present and past to get fates
isofate2prev<-merge(isofate2,past,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearPrev","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past, as well
head(isofate2)
head(isofate2prev); dim(isofate2prev)
colnames(isofate2prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutNoVegStems","FutNoArrStems","FutEmerg","Fate4"))
head(isofate3prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4"))
head(isofate3prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
colnames(isofate2prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","Fate4", "FutEmerg","PrevEmerg","PrevYrStage4")
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","Fate4", "FutEmerg","PrevEmerg","PrevYrStage4")
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
isofate2prev<-merge(isofate2,past,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearPrev","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past, as well
isofate2<-merge(present,future,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearFate","Group",  "Block", "Plant","YearFound"))#this only includes plants for which there is fate data that matches
dim(isofate);dim(isofate2)
head(isofate2)
colnames(isofate)
isofate=isofate[,-19]#remove year column
isofate2=isofate2[,-19]
#add column names
colnames(isofate)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Stage","Stage2","Stage3","Emerg","Stage4","FutNoVegStems","FutNoArrStems","FutNoFlStems","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","FutEmerg","Fate4")
present = isoinds[isoinds$Year < 2015& isoinds$Year >1983, ]; present = present[order(present$UniqueID),]; present = present[order(present$Year),]
dim(present)# 31837 rows, 18 columns
future = isoinds[isoinds$Year > 1984, ]; future = future[order(future$UniqueID),]; future = future[order(future$Year),]
dim(future)#31752 rows, 18 columns
head(present);head(future)
colnames(future)
future$YearFate=future$Year-1
#Merge present and future to get fates
isofate<-merge(present,future,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearFate","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past/future, as well
isofate2<-merge(present,future,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearFate","Group",  "Block", "Plant","YearFound"))#this only includes plants for which there is fate data that matches
dim(isofate);dim(isofate2)
head(isofate2)
colnames(isofate)
isofate=isofate[,-19]#remove year column
isofate2=isofate2[,-19]
#add column names
colnames(isofate)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Stage","Stage2","Stage3","Emerg","Stage4","FutNoVegStems","FutNoArrStems","FutNoFlStems","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","FutEmerg","Fate4")
colnames(isofate2)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Stage","Stage2","Stage3","Emerg","Stage4","FutNoVegStems","FutNoArrStems","FutNoFlStems","FutNoFrStems","FutTotNoStems","FutHeight","FutWidth","Fate","Fate2","Fate3","FutEmerg","Fate4")
head(isofate); head(isofate2)
#I think I will mostly use isofate2, which only includes matches, so stick with that one for rest of formatting
###Now add stage before dormancy to isofate2 dataset.
past = isoinds[isoinds$Year < 2015,]; past = past[order(past$UniqueID),]; past = past[order(past$Year),]
dim(past)# 32135 (present=31837 rows)
past$YearPrev=past$Year+1
#Merge present and past to get fates
isofate2prev<-merge(isofate2,past,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearPrev","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past, as well
head(isofate2)
head(isofate2prev); dim(isofate2prev)
#delete unncessary columns (we only want stage)
dim(isofate2prev)
head(isofate2prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutEmerg","Fate","PrevEmerg","PrevYrStage4")
head(isofate3prev)
isofate3prev[which(isofate3prev$PrevYrStage4=="VegSm" & isofate2prev$Stage4=="D"),]$Stage4="DSV"
head(isofate3prev)
isofate3prev[which(isofate3prev$PrevYrStage4=="VegSm" & isofate2prev$Stage=="D"),]$Stage="DSV"
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutEmerg","Fate","PrevEmerg","PrevYrStage")
head(isofate3prev[which(isofate3prev$PrevYrStage=="VegSm"),])
unique(isofate3prev$Stage)
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage="DSV"
head(isofate3prev[which(isofate3prev$PrevYrStage=="VegSm"),])
head(isofate3prev)
isofate2prev[which(isofate2prev$Stage2=="VegSm" & isofate2prev$Fate3=="D"),]$Fate3="DSV"
isofate3prev[which(isofate3prev$Stage=="VegSm" & isofate3prev$Fate=="D"),]$Fate="DSV"
head(isofate3prev)
tail(isofate3prev)
unique(isofate3prev$Stage)
isofate3prev$Stage.D<-NA
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="DSV"
unique(isofate3prev$Stage)
head(isofate3prev[which(isofate3prev$Stage=="D"),])
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="DSV"
head(isofate3prev[which(isofate3prev$PrevYrStage=="VegSm",])
head(isofate3prev[which(isofate3prev$PrevYrStage=="VegSm"),])
unique(isofate3prev[which(isofate3prev$PrevYrStage=="VegSm"),]$Fate)
x<-isofate3prev[which(isofate3prev$PrevYrStage=="VegSm"),]
head(x[which(x$Stage=="D"),])
past = isoinds[isoinds$Year < 2016,]; past = past[order(past$UniqueID),]; past = past[order(past$Year),]
dim(past)# 32135 (present=31837 rows)
past$YearPrev=past$Year+1
#Merge present and past to get fates
isofate2prev<-merge(isofate2,past,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearPrev","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past, as well
head(isofate2)
head(isofate2prev); dim(isofate2prev)
#delete unncessary columns (we only want stage)
dim(isofate2prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutEmerg","Fate","PrevEmerg","PrevYrStage")
#We will use Stage3 and Fate3 for now, so I am going to divide class "D" into 2 classes- SmvegbeforeD (DSV) and everything else (D)
isofate3prev$Stage.D<-NA
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="DSV"
unique(isofate3prev$Stage)
unique(isofate3prev$Stage.D)
isofate3prev[which(!isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="D"
unique(isofate3prev$Stage.D)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutEmerg","Fate","PrevEmerg","PrevYrStage")
#We will use Stage3 and Fate3 for now, so I am going to divide class "D" into 2 classes- SmvegbeforeD (DSV) and everything else (D)
isofate3prev$Stage.D<-NA
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage="DSV"
isofate2prev<-merge(isofate2,past,by.x=c("UniqueID","Year","Group",  "Block", "Plant","YearFound"),by.y=c("UniqueID","YearPrev","Group",  "Block", "Plant","YearFound"),all = TRUE)#this includes all plants, without matches in past, as well
head(isofate2)
head(isofate2prev); dim(isofate2prev)
#delete unncessary columns (we only want stage)
dim(isofate2prev)
isofate3prev<-subset(isofate2prev,select=c("UniqueID","Year","Group","Block","Plant","YearFound","NoVegStems.x","NoArrStems.x","NoFlStems.x","NoFrStems.x","TotNoStems.x","Height.x","Width","Emerg.x","Stage4.x","FutEmerg","Fate4","Emerg.y","Stage4.y"))
colnames(isofate3prev)=c("UniqueID","Year", "Group",  "Block", "Plant",  "YearFound","NoVegStems","NoArrStems","NoFlStems","NoFrStems","TotNoStems","Height","Width","Emerg","Stage","FutEmerg","Fate","PrevEmerg","PrevYrStage")
#We will use Stage3 and Fate3 for now, so I am going to divide class "D" into 2 classes- SmvegbeforeD (DSV) and everything else (D)
isofate3prev$Stage.D<-NA
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="DSV"
isofate3prev[which(!isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D="D"
unique(isofate3prev$Stage.D)
#need to add DSV to fate tooƒ
isofate3prev[which(isofate3prev$Stage=="VegSm" & isofate3prev$Fate=="D"),]$Fate="DSV"
unique(isofate3prev$Stage.D)
head(isofate3prev)
isofate3prev[which(isofate3prev$Stage=="VegSm" & isofate3prev$Fate=="D"),]$Fate<-"DSV"
isofate3prev[which(isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D<-"DSV"
isofate3prev[which(!isofate3prev$PrevYrStage=="VegSm" & isofate3prev$Stage=="D"),]$Stage.D<-"D"
head(isofate3prev[which(isofate3pre$stage==D),]
)
head(isofate3prev[which(isofate3prev$stage==D),])
head(isofate3prev[which(isofate3pre$Stage==D),]
)
head(isofate3prev[which(isofate3prev$Stage==D),])
head(isofate3prev[which(isofate3prev$Stage=="D"),])
head(isofate3prev[which(isofate3prev$Stage=="D"),])
head(isofate3prev[which(isofate3prev$Stage=="DSV"),])
head(isofate3prev[which(isofate3prev$Stage.D=="DSV"),])
#observed emergence
numsdsalive<-tapply(isofate3prev$FutEmerg,isofate3prev$Stage, sum)
numsds<-tapply(isofate3prev$FutEmerg,isofate3prev$Stage, length)
propemerg<-numsdsalive/numsds
propemerg#
isofate3prev$Stage<-as.factor(isofate3prev$Stage)
emerg.mod <- lmer(FutEmerg ~ -1 +Stage + (-1+Stage|Year), data=isofate3prev, family=binomial(link=logit))#change name to emerg.mod
library(lme4)
